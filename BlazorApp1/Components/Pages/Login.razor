@page "/"
@using BlazorApp1.Models
@using BlazorApp1.Services
@inject AuthService AuthService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

<h3>Вход</h3>

@if (isLoading)
{
    <p>Вход...</p>
}
else
{
    <EditForm EditContext="@editContext" Model="loginModel" FormName="Login User" OnValidSubmit="HandleLogin">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div>
            <label for="nameOfUser">Name: </label>
            <InputText id="nameOfUser" class="form-control" @bind-Value="loginModel.Username" />
        </div>
        <div>
            <label for="nameOfPrompt">Пароль: </label>
            <InputText id="nameOfPrompt" class="form-control" @bind-Value="loginModel.Password" />
        </div>

        <button type="submit" class="btn btn-primary">Save</button>

        <p>Нет аккаунта? <a href="/register">Хуле не зареган?</a>.</p>
    </EditForm>
}

@if (errorMessage != null)
{
    <p class="text-danger">@errorMessage</p>
}

@code {
    private RegisterModel loginModel = new();
    private EditContext editContext;
    private bool isLoading;
    private string? errorMessage;

    private async Task HandleLogin()
    {
        isLoading = true;
        errorMessage = null;
        
        Console.WriteLine($"{loginModel.Username}, {loginModel.Password}");

        var success = await AuthService.LoginAsync(loginModel.Username, loginModel.Password);

        if (success)
        {
            NavigationManager.NavigateTo("/home");
        }
        else
        {
            errorMessage = "Ошибка: Неправильный логин или пароль.";
        }

        isLoading = false;
    }
}